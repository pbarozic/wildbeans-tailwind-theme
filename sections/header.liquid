<header
  x-data="{ mobileMenuOpen: false }"
  class="sticky top-0 z-50 w-full bg-white border-b border-gray-200"
>
  <div class="flex items-center justify-between max-w-7xl mx-auto px-6 py-4">

    <!-- ======== MENU DESKTOP ======== -->
    {% if section.settings.menu != blank %}
      <nav class="hidden lg:flex items-center space-x-8 uppercase text-sm font-semibold tracking-wide text-gray-800">
        {% for link in linklists[section.settings.header-menu].links %}
          {% if link.links != blank %}
            <div x-data="{ open: false }" class="relative">
              <button
                @click="open = !open"
                class="hover:text-gray-500 focus:outline-none flex items-center"
              >
                {{ link.title }}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 transition-transform duration-200" :class="open ? 'rotate-180' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>

              <div
                x-show="open"
                @click.away="open = false"
                x-transition
                class="absolute left-0 mt-3 bg-white border border-gray-200 rounded-lg shadow-lg py-2 w-48"
              >
                {% for child_link in link.links %}
                  <a href="{{ child_link.url }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                    {{ child_link.title }}
                  </a>
                {% endfor %}
              </div>
            </div>
          {% else %}
            <a href="{{ link.url }}" class="hover:text-gray-500">
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>
    {% endif %}

    <!-- ======== LOGO CENTRÉ ======== -->
    <div class="flex-shrink-0">
      <a href="{{ routes.root_url }}" class="flex items-center">
        {% if settings.logo != blank %}
          {{ settings.logo | image_url: width: 200 | image_tag: class: 'h-10 w-auto', alt: shop.name }}
        {% else %}
          <span class="font-bold text-lg text-gray-800">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    <!-- ======== BOUTONS À DROITE ======== -->
    <div class="hidden lg:flex items-center space-x-4">
      <a href="{{ routes.cart_url }}" class="text-sm font-semibold uppercase bg-gray-900 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
        Purchase
      </a>
      {% if shop.customer_accounts_enabled %}
        <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
           class="text-sm font-semibold uppercase text-gray-800 hover:text-gray-500">
          {% if customer %}Account{% else %}Login{% endif %}
        </a>
      {% endif %}
    </div>

    <!-- ======== BOUTON BURGER (MOBILE) ======== -->
    <button
      @click="mobileMenuOpen = true"
      class="lg:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-800 hover:bg-gray-100 focus:outline-none"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
        viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <!-- ======== DRAWER MOBILE ======== -->
  <div
    x-show="mobileMenuOpen"
    x-transition
    class="fixed inset-0 z-50 flex"
    style="display: none;"
  >
    <!-- Overlay -->
    <div class="fixed inset-0 bg-black/30" @click="mobileMenuOpen = false"></div>

    <!-- Drawer -->
    <div class="relative w-64 bg-white shadow-xl border-r border-gray-200 z-50 p-6 flex flex-col">
      <div class="flex justify-between items-center mb-6">
        <span class="font-bold text-gray-900 text-lg">{{ shop.name }}</span>
        <button @click="mobileMenuOpen = false" class="p-2 rounded-md hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      {% if section.settings.menu != blank %}
        <nav class="space-y-4 uppercase text-sm font-semibold text-gray-800">
          {% for link in linklists[section.settings.menu].links %}
            {% if link.links != blank %}
              <div x-data="{ open: false }">
                <button
                  @click="open = !open"
                  class="w-full flex justify-between items-center hover:text-gray-500"
                >
                  {{ link.title }}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-200" :class="open ? 'rotate-180' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div x-show="open" x-transition class="ml-4 mt-2 space-y-2">
                  {% for child_link in link.links %}
                    <a href="{{ child_link.url }}" class="block text-gray-600 hover:text-gray-800 text-sm">
                      {{ child_link.title }}
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% else %}
              <a href="{{ link.url }}" class="block hover:text-gray-500">
                {{ link.title }}
              </a>
            {% endif %}
          {% endfor %}
        </nav>
      {% endif %}

      <div class="mt-auto pt-6 border-t border-gray-200 space-y-3">
        <a href="{{ routes.cart_url }}" class="block text-center text-sm font-semibold uppercase bg-gray-900 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
          Purchase
        </a>
        {% if shop.customer_accounts_enabled %}
          <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
             class="block text-center text-sm font-semibold uppercase text-gray-800 hover:text-gray-500">
            {% if customer %}Account{% else %}Login{% endif %}
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</header>
